---
title: Codeur rotatif et afficheur 7 segments sous RaspberryPi
permalink: raspberryPi-codeurRotatif-afficheur7segments-led
layout: post
date: 2015-05-15 20:31:00
tags: [raspberryPi, python, rotaryEncoder, shaftEncoder, 7segments, led]
category: raspberryPi
---

Dans cet article, on va décrire comment faire fonctionner un codeur rotatif
pour piloter un affichier LED à sept segments.
Le but est le suivant 
- L'appui sur le bouton central, allume ou éteint l'afficheur LED
- La rotation dans le sens des aiguilles d'une montre incrémente 
  le compteur qui s'affiche avec un maximum à 9
- La rotation dans le sens inverse des aiguilles d'une montre décrémente
  le compteur qui s'affiche avec un minimum à 0


## Fonctionnement du codeur rotatif

On commence par vérifier le fonctionnement de l'encodeur rotatif en
affichant des messages à l'écran.


### Les connexions

D'abord les branchements

Rotary encoder | Raspberry Pi
---------------|-------------
           CLK | GPIO 21
            DT | GPIO 20
            SW | GPIO 16
             + | GPIO 5V
           GND | GPIO Ground

### Le code

Il existe de nombreuses façons de programmer l'intéraction avec le codeur
rotatif. Ici on va se baser sur la classe `RotaryEncoder` de Bob Rathbone.


```
$ wget https://raw.githubusercontent.com/bobrathbone/pirotary/master/rotary_class.py
```

Une fois le fichier `rotary_class.py` déposé dans le bon dossier,
ouvrons leafpad pour écrire le programme suivant qu'on nomme `rotary.py`


```python
from rotary_class import RotaryEncoder
from time import sleep

# Define GPIO inputs
SW = 16
DT = 20
CLK = 21

# Fonction de callback qui agit selon les evenements
def switch_event(event):
        if event == RotaryEncoder.CLOCKWISE:
              print("Plus")
              sleep(.2)
        elif event == RotaryEncoder.ANTICLOCKWISE:
              print("Moins")
              sleep(.2)
        elif event == RotaryEncoder.BUTTONDOWN:
              print("Bdown")
        return

# Definit la détection de front
rswitch = RotaryEncoder(CLK,DT,SW,switch_event)

try:
  print("Le programme fonctionne pendant 60s.")
  sleep(60)

except KeyboardInterrupt:
  print("\nInterruption par clavier.")

finally:
  print("On arrete tout")
```

On peut maintenant lancer le programme et observer la console lorsqu'on agit sur
le codeur en appuyant sur le poussoir ou tournant dans un sens ou dans l'autre.

```
$ sudo python rotary.py
```


## Fonctionnement de l'afficheur LED 7 segments

![7 segments](http://upload.wikimedia.org/wikipedia/commons/thumb/a/ad/Seven_segment_02_Pengo.jpg/280px-Seven_segment_02_Pengo.jpg)

Il y a deux sortes d'afficheurs 7 segments

- afficheur à **anode** commune : toutes les anodes sont reliées et connectées au
  potentiel haut. La commande du segment se fait par sa cathode mise au
  potentiel bas.
- afficheur à **cathode** commune : toutes les cathodes sont reliées et connectées
  au potentiel bas.  La commande du segment se fait par son anode mise au
  potentiel haut.


Le kit [*Sunfounder Project Super Starter Kit for Raspberry Pi*](http://www.amazon.fr/gp/product/B00P2E9W30?psc=1&redirect=true&ref_=oh_aui_detailpage_o04_s00)
fournit deux afficheurs à cathode commune, c'est de ce type d'afficheur dont il
est désormais question.

Un afficheur 7 segments (8 en fait si on compte le DP pour *Decimal Point* 
en bas à droite) possède 10 connecteurs.

- deux cathodes communes on relie l'une d'entre elles via une résistance de 
  1KOhm à la masse.
- 8 connecteurs qui recevront un signal haut ou bas pour allumer ou éteindre 
  chacun des segments.

Nous allons voir comment multiplexer l'afficheur 7 Segments avec un registre à décalage 74HC595N.


